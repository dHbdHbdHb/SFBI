"0","stanford_boundary <- places(""CA"", cb = T) %>% "
"0","  filter(NAME == ""Stanford"") %>% "
"0","  st_transform(4326)"
"2","Using FIPS code '06' for state 'CA'
"
"1","  |                                                                                                      "
"1","  |                                                                                                |   0%"
"1","  |                                                                                                      "
"1","  |=                                                                                               |   1%"
"1","  |                                                                                                      "
"1","  |==                                                                                              |   2%"
"1","  |                                                                                                      "
"1","  |==                                                                                              |   3%"
"1","  |                                                                                                      "
"1","  |===                                                                                             |   3%"
"1","  |                                                                                                      "
"1","  |====                                                                                            |   4%"
"1","  |                                                                                                      "
"1","  |====                                                                                            |   5%"
"1","  |                                                                                                      "
"1","  |=====                                                                                           |   5%"
"1","  |                                                                                                      "
"1","  |======                                                                                          |   7%"
"1","  |                                                                                                      "
"1","  |=======                                                                                         |   7%"
"1","  |                                                                                                      "
"1","  |=======                                                                                         |   8%"
"1","  |                                                                                                      "
"1","  |========                                                                                        |   8%"
"1","  |                                                                                                      "
"1","  |=========                                                                                       |   9%"
"1","  |                                                                                                      "
"1","  |==========                                                                                      |  10%"
"1","  |                                                                                                      "
"1","  |============                                                                                    |  13%"
"1","  |                                                                                                      "
"1","  |==============                                                                                  |  15%"
"1","  |                                                                                                      "
"1","  |===============                                                                                 |  15%"
"1","  |                                                                                                      "
"1","  |================                                                                                |  17%"
"1","  |                                                                                                      "
"1","  |==================                                                                              |  19%"
"1","  |                                                                                                      "
"1","  |====================                                                                            |  21%"
"1","  |                                                                                                      "
"1","  |=====================                                                                           |  22%"
"1","  |                                                                                                      "
"1","  |=======================                                                                         |  24%"
"1","  |                                                                                                      "
"1","  |========================                                                                        |  25%"
"1","  |                                                                                                      "
"1","  |==========================                                                                      |  27%"
"1","  |                                                                                                      "
"1","  |===========================                                                                     |  28%"
"1","  |                                                                                                      "
"1","  |===========================                                                                     |  29%"
"1","  |                                                                                                      "
"1","  |=============================                                                                   |  30%"
"1","  |                                                                                                      "
"1","  |==============================                                                                  |  31%"
"1","  |                                                                                                      "
"1","  |===============================                                                                 |  32%"
"1","  |                                                                                                      "
"1","  |================================                                                                |  33%"
"1","  |                                                                                                      "
"1","  |=================================                                                               |  35%"
"1","  |                                                                                                      "
"1","  |==================================                                                              |  36%"
"1","  |                                                                                                      "
"1","  |====================================                                                            |  37%"
"1","  |                                                                                                      "
"1","  |=====================================                                                           |  38%"
"1","  |                                                                                                      "
"1","  |======================================                                                          |  39%"
"1","  |                                                                                                      "
"1","  |=======================================                                                         |  41%"
"1","  |                                                                                                      "
"1","  |========================================                                                        |  42%"
"1","  |                                                                                                      "
"1","  |=========================================                                                       |  43%"
"1","  |                                                                                                      "
"1","  |============================================                                                    |  45%"
"1","  |                                                                                                      "
"1","  |=============================================                                                   |  47%"
"1","  |                                                                                                      "
"1","  |===============================================                                                 |  49%"
"1","  |                                                                                                      "
"1","  |================================================                                                |  50%"
"1","  |                                                                                                      "
"1","  |=================================================                                               |  52%"
"1","  |                                                                                                      "
"1","  |===================================================                                             |  53%"
"1","  |                                                                                                      "
"1","  |=====================================================                                           |  55%"
"1","  |                                                                                                      "
"1","  |======================================================                                          |  56%"
"1","  |                                                                                                      "
"1","  |=======================================================                                         |  58%"
"1","  |                                                                                                      "
"1","  |========================================================                                        |  59%"
"1","  |                                                                                                      "
"1","  |==========================================================                                      |  60%"
"1","  |                                                                                                      "
"1","  |============================================================                                    |  62%"
"1","  |                                                                                                      "
"1","  |=============================================================                                   |  63%"
"1","  |                                                                                                      "
"1","  |==============================================================                                  |  65%"
"1","  |                                                                                                      "
"1","  |===============================================================                                 |  66%"
"1","  |                                                                                                      "
"1","  |================================================================                                |  67%"
"1","  |                                                                                                      "
"1","  |==================================================================                              |  68%"
"1","  |                                                                                                      "
"1","  |===================================================================                             |  70%"
"1","  |                                                                                                      "
"1","  |====================================================================                            |  71%"
"1","  |                                                                                                      "
"1","  |=====================================================================                           |  72%"
"1","  |                                                                                                      "
"1","  |======================================================================                          |  73%"
"1","  |                                                                                                      "
"1","  |=======================================================================                         |  74%"
"1","  |                                                                                                      "
"1","  |=========================================================================                       |  76%"
"1","  |                                                                                                      "
"1","  |==========================================================================                      |  77%"
"1","  |                                                                                                      "
"1","  |===========================================================================                     |  78%"
"1","  |                                                                                                      "
"1","  |============================================================================                    |  79%"
"1","  |                                                                                                      "
"1","  |=============================================================================                   |  80%"
"1","  |                                                                                                      "
"1","  |==============================================================================                  |  82%"
"1","  |                                                                                                      "
"1","  |===============================================================================                 |  83%"
"1","  |                                                                                                      "
"1","  |=================================================================================               |  84%"
"1","  |                                                                                                      "
"1","  |==================================================================================              |  85%"
"1","  |                                                                                                      "
"1","  |===================================================================================             |  86%"
"1","  |                                                                                                      "
"1","  |====================================================================================            |  88%"
"1","  |                                                                                                      "
"1","  |=========================================================================================       |  92%"
"1","  |                                                                                                      "
"1","  |==========================================================================================      |  94%"
"1","  |                                                                                                      "
"1","  |============================================================================================    |  96%"
"1","  |                                                                                                      "
"1","  |================================================================================================| 100%"
"1","
"
"0","stanford_sensors <- bay_sensors_clean %>% "
"0","  .[stanford_boundary,]"
"0",""
"0","start <- ""2021-11-28%2000:08:00"""
"0","end <- ""2021-12-05%2000:08:00"""
"0",""
"0","stanford_sensor_data <- "
"0","  1:nrow(stanford_sensors) %>% "
"0","  map_dfr(function(row){"
"0","  "
"0","  print(paste0(row,"". "",stanford_sensors[row,]$sensor_index))"
"0","  "
"0","  a1 <- read_csv(paste0("
"0","    ""https://api.thingspeak.com/channels/"","
"0","    stanford_sensors[row,]$primary_id_a,"
"0","    ""/feeds.csv?api_key="","
"0","    stanford_sensors[row,]$primary_key_a,"
"0","    ""&average=1440&round=3&start="",start,"
"0","    ""&end="", end, "
"0","    ""&timezone=America/Los_Angeles"""
"0","  ), show_col_types = F) %>% "
"0","    set_names(c(""created_at"",""PM1.0_CF_1_ug/m3_A"",""PM2.5_CF_1_ug/m3_A"",""PM10.0_CF_1_ug/m3_A"",""Uptime_Minutes_A"",""RSSI_dbm_A"",""Temperature_F_A"",""Humidity_%_A"",""PM2.5_CF_ATM_ug/m3_A""))"
"0","      "
"0","  a2 <- read_csv(paste0("
"0","    ""https://api.thingspeak.com/channels/"","
"0","    stanford_sensors[row,]$secondary_id_a,"
"0","    ""/feeds.csv?api_key="","
"0","    stanford_sensors[row,]$secondary_key_a,"
"0","    ""&average=1440&round=3&start="",start,"
"0","    ""&end="", end, "
"0","    ""&timezone=America/Los_Angeles"""
"0","  ), show_col_types = F) %>% "
"0","    set_names(c(""created_at"",""0.3um/dl_A"",""0.5um/dl_A"",""1.0um/dl_A"",""2.5um/dl_A"",""5.0um/dl_A"",""10.0um/dl_A"",""PM1.0_CF_ATM_ug/m3_A"",""PM10_CF_ATM_ug/m3_A""))"
"0","    "
"0","  b1 <- read_csv(paste0("
"0","    ""https://api.thingspeak.com/channels/"","
"0","    stanford_sensors[row,]$primary_id_b,"
"0","    ""/feeds.csv?api_key="","
"0","    stanford_sensors[row,]$primary_key_b,"
"0","    ""&average=1440&round=3&start="",start,"
"0","    ""&end="", end, "
"0","    ""&timezone=America/Los_Angeles"""
"0","  ), show_col_types = F) %>% "
"0","    set_names(c(""created_at"",""PM1.0_CF_1_ug/m3_B"",""PM2.5_CF_1_ug/m3_B"",""PM10.0_CF_1_ug/m3_B"",""HEAP_B"",""ADC0_voltage_B"",""Atmos_Pres_B"",""Not_Used_B"",""PM2.5_CF_ATM_ug/m3_B""))"
"0","  "
"0","  b2 <- read_csv(paste0("
"0","    ""https://api.thingspeak.com/channels/"","
"0","    stanford_sensors[row,]$secondary_id_b,"
"0","    ""/feeds.csv?api_key="","
"0","    stanford_sensors[row,]$secondary_key_b,"
"0","    ""&average=1440&round=3&start="",start,"
"0","    ""&end="", end, "
"0","    ""&timezone=America/Los_Angeles"""
"0","  ), show_col_types = F) %>% "
"0","    set_names(c(""created_at"",""0.3um/dl_B"",""0.5um/dl_B"",""1.0um/dl_B"",""2.5um/dl_B"",""5.0um/dl_B"",""10.0um/dl_B"",""PM1.0_CF_ATM_ug/m3_B"",""PM10_CF_ATM_ug/m3_B""))"
"0","  "
"0","  combined <- a1 %>% "
"0","    left_join(a2, by = ""created_at"") %>% "
"0","    left_join(b1, by = ""created_at"") %>% "
"0","    left_join(b2, by = ""created_at"") %>% "
"0","    transmute("
"0","      date = as.Date(created_at),"
"0","      ID = as.numeric(stanford_sensors[row,]$sensor_index),"
"0","      Location = stanford_sensors[row,]$location_type,"
"0","      PM25 = 0.524*as.numeric(`PM2.5_CF_1_ug/m3_A`) - 0.0852*as.numeric(`Humidity_%_A`) + 5.72"
"0","    )"
"0",""
"0","}) %>% "
"0","  group_by(date, Location) %>% "
"0","  summarize("
"0","    PM25 = mean(PM25, na.rm = T)"
"0","  )"
"1","[1]"
"1"," ""1. 3327"""
"1","
"
"1","[1]"
"1"," ""2. 19054"""
"1","
"
"1","[1]"
"1"," ""3. 20857"""
"1","
"
"1","[1]"
"1"," ""4. 22037"""
"1","
"
"1","[1]"
"1"," ""5. 41675"""
"1","
"
"1","[1]"
"1"," ""6. 54565"""
"1","
"
"1","[1]"
"1"," ""7. 59931"""
"1","
"
"1","[1]"
"1"," ""8. 74303"""
"1","
"
"1","[1]"
"1"," ""9. 82213"""
"1","
"
"1","[1]"
"1"," ""10. 92053"""
"1","
"
"1","[1]"
"1"," ""11. 94955"""
"1","
"
"1","[1]"
"1"," ""12. 101221"""
"1","
"
"1","[1]"
"1"," ""13. 105392"""
"1","
"
"1","[1]"
"1"," ""14. 111373"""
"1","
"
"1","[1]"
"1"," ""15. 117123"""
"1","
"
"1","[1]"
"1"," ""16. 117311"""
"1","
"
"1","[1]"
"1"," ""17. 119381"""
"1","
"
"1","[1]"
"1"," ""18. 124697"""
"1","
"
"1","[1]"
"1"," ""19. 124709"""
"1","
"
"1","[1]"
"1"," ""20. 124725"""
"1","
"
"1","[1]"
"1"," ""21. 124775"""
"1","
"
"1","[1]"
"1"," ""22. 124777"""
"1","
"
"1","[1]"
"1"," ""23. 127759"""
"1","
"
"1","`summarise()` has grouped output by 'date'. You can override using the `.groups` argument.
"
